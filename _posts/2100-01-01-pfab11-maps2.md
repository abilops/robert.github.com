For the next few weeks we're going to look at a small web application called Eat/Play/Drink, created by Sophia Li. Eat/Play/Drink shows the user a curated map of places to eat, play, and drink, and allows them to filter the markers shown on the map by category. It uses JavaScript and HTML.

Over the coming weeks we're going to look at how Sophie could restructure her app to significantly reduce the number and type of bugs that it's possible to introduce to it in the future. But this week I want to start by talking about a significant design choice that Sophie made that I like a lot.

### Separating data and logic

The JavaScript logic for Eat/Play/Drink lives in a file called `app.js`. This code creates Google Maps markers and info boxes, and contains the logic that shows and hides these components whenever a user clicks on a filter button. At the top of `app.js` is an array called `markers`. This array contains details about each place on the Eat/Play/Drink map, including a place's co-ordinates, category, and description.

```javascript
const markers = [
  {
    coords: { lat: 37.7638, lng: -122.469 },
    content:
      "<h3>San Tung</h3><p>Chinese restaurant with delicious dry fried chicken wings.</p><a href='https://goo.gl/maps/wiqva8qzW9bBoJRJ6' target='_blank'>Get directions</a>",
    category: "eat"
  },
  // ...etc...
}
```

I really like this array, because it means that the data that powers the website is stored completely separately from the logic that displays it. This is a valuable property, for two reasons.

First, it is an almost univerally good thing to keep different components of your code separate from each other, whatever those components may be. As we've talked about at length in previous PFABs, the resulting code will typically be easier to understand and work with as a natural, inevitable consequence. 

Second, separating logic and data brings additional, specific benefits. It means that we can add new places to the Eat/Play/Drink app without needing to even think about touching the code that is responsible for displaying these new places. Instead, we add our new places to our data structure in a simple, well-defined format, press save and refresh the page, and the new markers and info-windows are immediately available to be clicked on.

### Future benefits of separating logic and data

As well as improving our lives in the short-term, separating logic and data opens up extra possibilities for the future too.

#### Making updates simpler

For example, we could make our app easy to update by anyone, even people who might not know anything about programming. We already have a good level of separation, but it might still be a little intimidating to ask someone with little familiarity with programming or this app to edit a JavaScript file. We could therefore extract our data to an entirely separate file (perhaps called `places.json`), which would contain only our places data.

Adding a few lines to a simple config file is much less daunting than editing a file of JavaScript, no matter how well separated that JavaScript might be. We completely hide the complexity that goes into turning the data into maps and markers.

#### Making the app reusable

Eat/Play/Drink is a delightful, simple application. It deliberately and sensibly focusses entirely on San Francisco. But what if Sophia's cousin who lives in Austin (assume that Sophia has a cousin who lives in Austin) wanted to make their own version to showcase all his favorite local spots? At the moment we would have to send him the code and a list of instructions for which parts of it he needs to edit. For example, we would need to tell him to update `app.js` so that it CONTINUE

It would not take much work to refactor the Eat/Play/Drink codebase into a generic, customizable framework that could be reused by anyone to create an app to display their favorite places in their own city. To make this refactoring, we would start by moving all the places data into a config file, as described above. Then we would go through the rest of the app and move all of the San-Francisco-specific pieces into our config file too.

For example, `app.js` contains hardcoded values for the centre of the map. We could move these values into the config file and load them from there. `index.html` includes a description of the site - `A list of the best places to eat, play, and drink in San Francisco, curated by a San Franciso native`. We could move this into the config file too.

Finally, we could either stipulate that our app can only be used with the categories `eat`, `play`, and `drink`, or we could even move these categories into our config file too. This would allow future programmers reusing our code to easily create their own categories, such as `run`, `swim`, `bike`.

### Possible improvement

I'm not actually sure if this suggestion is a good idea, but let's discuss it anyway.

You may notice that the `content` field in each element in the `markers` array always follows the same structure. For example:

```
<h3>Manna</h3><p>Hole-in-the-wall family-owned Korean restaurant with the best tofu soup.</p><a href='https://goo.gl/maps/TkAFCrGrswH76hmT8' target='_blank'>Get directions</a>
```

There's a header, a description, and a link to get directions. Suppose we wanted to change the `Get directions` link to instead say simply `Directions`. We'd have to go through each `content` field and manually update the value. And suppose we wanted to allow people not familiar with programming to add and update places. They could probably copy-and-paste an example, but there's a significant risk that they might accidentally delete a closing `</h3>` tag or similar (come to think of it there's a significant risk that I would accidentally delete a closing `</h3>` tag too).

We could therefore extract each component of this `content` field into its own field, and join them together into a fully rendered block using code. Instead of this:

```
{
  content: "<h3>Manna</h3><p>Hole-in-the-wall family-owned Korean restaurant with the best tofu soup.</p><a href='https://goo.gl/maps/TkAFCrGrswH76hmT8' target='_blank'>Get directions</a>",
  // ...etc...
}
```

We would write this:

```
{
  name: "Manna",
  description: "Hole-in-the-wall family-owned Korean restaurant with the best tofu soup.",
  directions_url: "https://goo.gl/maps/TkAFCrGrswH76hmT8",
  // ...etc...
}
```

We would then write code that turned the above parameters into the same fully-rendered that we previously wrote.

This approach has several advantages. First, it further separates data from logic and presentation. Previously, if you wanted to change the way that info cards looked then you had to edit your data file. Now you edit your presentation code instead. This is as it should be.

Second, it means that things are good, see above.

However, the approach is not without its tradeoffs. By standardizing on a structure we make it easy to create info windows that follow this structure, but harder to make ones that don't. The current structure is title, one paragraph of description, link to directions. If you want two paragraphs of description, or an image, or you don't want a link to any directions, then you're going to have a problem. You would have to update the code that builds our info window content to accept additional, optional parameters, such as `description_2`, `image_url`, `hide_directions_link`, and so on. If there are a sufficiently small number of these extra customizations then this might be reasonable. But if you end up with twenty different configurable fields that potentially interact with each other in surprising and complex ways (what should happen if `hide_directions_link` and `directions_url` are both set?) then you might find yourself wishing you had simply allowed users to input their own custom HTML.

I usually approach decisions like this by starting with the simplest thing, and only adding specialized code when I understand the problem that I'm trying to solve and have a good idea for how many additional, custom options are likely to be required.

Another good way to decide whether it's worth investing in the kind of refactoring I've described above is to wait until the problems that you think it will solve have actually become problems for you. For example, I've claimed that structuring your code in the way above will reduce the number of silly mistakes and bugs, and will make it easier to update the appearence of every info window at once. You can guess whether or not this will be useful to you by thinking about how often silly mistakes and bugs have been introduced as a result of messing up HTML. You can also think about how often you have updates the appearence of every info window in the past, and whether or not the process of doing so was particularly annoying.

### Drawing the line

Suppose that we did decide to refactor our data file into the form above, with separate fields for `name`, `description`, and `directions_url`. You may notice that every directions URL is of the form `https://goo.gl/maps/$UNIQUE_ID`. We could therefore potentially save a few characters by turning the `directions_url` field into `directions_google_id`, which only contains the unique ID in the `goo.gl/maps` URL. For example:

```
{
  name: "Manna",
  description: "Hole-in-the-wall family-owned Korean restaurant with the best tofu soup.",
  directions_google_id: "TkAFCrGrswH76hmT8",
  // ...etc...
}
```

Our info-window-building code would turn `TkAFCrGrswH76hmT8` into `https://goo.gl/maps/TkAFCrGrswH76hmT8` before inserting it into the directinos link.

However, in my opinion this would be a step too far. Saving keystrokes is a good instinct, but not if it causes unacceptable compromise to flexibility and clarity. I think that this change would severely affect both of these properties. It would make our config file less clear to read and work with. "Create a `goo.gl` link but then chop off everything except the random characters at the end" is a more complicated instruction than "create a `goo.gl` link and copy it". Furthermore, suppose we decided that for some places, Bing Maps gave better directions. We've embedded into our program the assumption that all our directions come from Google. We could add an extra field called `directions_bing_id`, but then we're starting to add a lot more complexity for minimal gain.

There are no hard rules about the right amount of field extraction to perform. You have to consider the tradeoffs for each individual case, and if in doubt err towards doing nothing.






